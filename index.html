<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Virtual Tabletop – MVP (Firebase)</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; font-family: sans-serif; }
    #app { height: 100%; display: flex; flex-direction: column; }
    #lobby, #tableView { flex: 1; display: none; }
    #lobby { padding: 16px; }
    #tableView { display: none; flex-direction: column; height: 100%; }
    #roomHeader { padding: 8px 12px; border-bottom: 1px solid #ccc; display: flex; align-items: center; gap: 8px; justify-content: space-between; }
    #roomMain { flex: 1; display: flex; min-height: 0; }
    #sidebar { width: 260px; background: #1f2933; color: #f9fafb; display: none; flex-direction: column; padding: 8px; font-size: 13px; }
    #gameArea { flex: 1; display: flex; flex-direction: column; min-width: 0; }
    #seatsBar { height: 70px; background: #f3f4f6; display: flex; align-items: center; padding: 4px 8px; gap: 8px; }
    #playArea { position: relative; flex: 1; background: #e5e7eb; overflow: hidden; }
    #playInner { position: relative; width: 100%; height: 100%; }
    #editOverlay { position: absolute; inset: 0; background: rgba(0,0,0,0.25); pointer-events: none; display: none; }
    #handBar { height: 80px; background: #e5e7eb; border-top: 1px solid #ccc; display: flex; align-items: center; padding: 4px 8px; gap: 8px; font-size: 13px; }
    .seat-card { min-width: 120px; padding: 4px 6px; border-radius: 6px; border: 1px solid #4b5563; background: #e0f2fe; display: flex; flex-direction: column; font-size: 11px; }
    button { cursor: pointer; }
    #log { font-size: 11px; padding: 4px 8px; border-top: 1px solid #eee; background: #fafafa; height: 60px; overflow: auto; }
  </style>
</head>
<body>

<div id="app">

  <div id="lobby">
    <h1>Virtual Tabletop – Lobby</h1>

    <section id="identity">
      <h2>Identidade</h2>

      <p id="authStatus">Conectando...</p>

      <label>
        Seu nome:
        <input id="playerNameInput" type="text" placeholder="Seu nome">
      </label>
      <button id="btnSaveName">Salvar nome</button>
    </section>

    <section>
      <h2>Salas</h2>
      <input id="newRoomName" placeholder="Nome da sala">
      <button id="btnCreateRoom">Criar sala</button>

      <h3>Minhas salas</h3>
      <ul id="roomList"></ul>
    </section>
  </div>

  <div id="tableView">
    <div id="roomHeader">
      <div id="roomHeaderLeft">
        <button id="btnBackToLobby">Voltar ao lobby</button>
        <span id="roomInfo"></span>
      </div>
      <div id="roomHeaderRight">
        <button id="btnAddSeat">Adicionar assento</button>
        <button id="btnRemoveSeat">Remover último assento</button>
        <button id="btnReset">Resetar baralho</button>
        <button id="btnShuffle">Embaralhar baralho</button>
        <button id="btnToggleEdit" style="display:none;">Entrar no modo edição</button>
      </div>
    </div>

    <div id="roomMain">
      <div id="sidebar">
        <h3>Modo edição</h3>
        <section><strong>Componentes</strong><p>(futuro)</p></section>
        <section><strong>Propriedades</strong><p>(futuro)</p></section>
      </div>

      <div id="gameArea">
        <div id="seatsBar"></div>

        <div id="playArea">
          <div id="playInner"></div>
          <div id="editOverlay"></div>
        </div>

        <div id="handBar">
          <span id="handTitle">Sua mão:</span>
          <span id="handContent">Você não está em nenhum assento.</span>
        </div>

        <pre id="log"></pre>
      </div>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import {
    getAuth,
    signInAnonymously,
    updateProfile,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    collection,
    addDoc,
    setDoc,
    updateDoc,
    getDoc,
    onSnapshot,
    serverTimestamp,
    query,
    where,
    getDocs
  } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  import { firebaseConfig } from "./firebaseConfig.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window._firebase = {
    auth,
    db,
    fs: {
      doc, collection, addDoc, setDoc, updateDoc,
      getDoc, onSnapshot, serverTimestamp, query, where, getDocs
    },
    signInAnonymously,
    updateProfile,
    onAuthStateChanged
  };

  import("./client.js");
</script>

</body>
</html>
